<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="DoroFill - ìš´í–‰ì œí•œ ìœ„ë°˜ ì ë°œ ë³´ê³ ì„œ ì‘ì„±">
    <title>ì ë°œ ë³´ê³ ì„œ - DoroFill</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- pdf-lib CDN -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- fontkit for custom fonts (Korean support) -->
    <script src="https://unpkg.com/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>
    <!-- PDF.js for PDF to image conversion (Gemini analysis) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Google Fonts - Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Noto Sans KR', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#2563eb',
                            600: '#1d4ed8',
                            700: '#1e40af',
                            800: '#1e3a8a',
                            900: '#1e3a8a',
                        },
                        success: '#10b981',
                        warning: '#ef4444',
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen bg-gray-50 font-sans">
    <!-- Fixed Header -->
    <header class="header-fixed bg-white shadow-sm">
        <div class="container flex items-center justify-between h-full">
            <!-- Back Button -->
            <a href="index.html"
                class="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors min-w-[44px] min-h-[44px] justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                <span class="text-sm hidden sm:inline">ëŒì•„ê°€ê¸°</span>
            </a>

            <!-- Title -->
            <h1 class="text-lg font-bold text-gray-900">ì ë°œ ë³´ê³ ì„œ ì‘ì„±</h1>

            <!-- Save Button -->
            <button type="button" id="btn-save"
                class="flex items-center gap-1 px-3 py-2 text-sm font-medium text-primary-500 hover:bg-primary-50 rounded-lg transition-colors min-w-[44px] min-h-[44px] justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4">
                    </path>
                </svg>
                <span class="hidden sm:inline">ì €ì¥</span>
            </button>
        </div>
    </header>

    <!-- Main Content - Scrollable Area -->
    <main class="main-content">
        <div class="container">
            <form id="reportForm" novalidate>

                <!-- PDF í…œí”Œë¦¿ ì„ íƒ ì„¹ì…˜ -->
                <section class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4 animate-fade-in">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-blue-700 mb-1">ğŸ“ PDF í…œí”Œë¦¿ ì„ íƒ</h3>
                            <p class="text-sm text-gray-600 mb-3">
                                ì‘ì„±í•  PDF ì–‘ì‹ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”. <span class="text-gray-400">(ìµœì´ˆ 1íšŒë§Œ í•„ìš”)</span>
                            </p>

                            <label class="block">
                                <input type="file" id="pdfTemplateFile" accept=".pdf" class="block w-full text-sm text-gray-500
                                        file:mr-3 file:py-2 file:px-4
                                        file:rounded-lg file:border-0
                                        file:text-sm file:font-medium
                                        file:bg-blue-500 file:text-white
                                        hover:file:bg-blue-600
                                        file:cursor-pointer cursor-pointer
                                        file:transition-colors" />
                            </label>

                            <div id="templateStatus" class="mt-2 text-sm"></div>

                            <!-- AI ë¶„ì„ ë²„íŠ¼ -->
                            <div id="aiAnalyzeSection" class="mt-3 pt-3 border-t border-blue-200 hidden">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-gray-600">AI ì¢Œí‘œ ë¶„ì„</span>
                                    <span id="aiCoordinatesStatus" class="text-xs text-gray-400"></span>
                                </div>
                                <button type="button" id="analyzeTemplateBtn"
                                    class="w-full py-2.5 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white text-sm font-medium rounded-lg flex items-center justify-center gap-2 transition-all active:scale-[0.98]">
                                    <span>ğŸ¤–</span>
                                    <span>AI ì¢Œí‘œ ë¶„ì„</span>
                                </button>
                                <p class="text-xs text-gray-400 mt-1">Gemini 2.0 Flashë¡œ í•„ë“œ ìœ„ì¹˜ë¥¼ ìë™ ê°ì§€í•©ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 1: ê¸°ë³¸ ì •ë³´ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <!-- Section Header -->
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">ğŸ“</span>
                        ê¸°ë³¸ ì •ë³´
                    </h2>

                    <!-- ì ë°œ ì¼ì‹œ -->
                    <div class="form-group">
                        <label for="reportDatetime" class="form-label form-label-required">
                            ì ë°œ ì¼ì‹œ
                        </label>
                        <input type="datetime-local" id="reportDatetime" name="reportDatetime" class="form-input w-full"
                            required>
                        <p class="text-xs text-gray-500 mt-1">ìœ„ë°˜ ì°¨ëŸ‰ì„ ì ë°œí•œ ë‚ ì§œì™€ ì‹œê°„</p>
                    </div>

                    <!-- ì ë°œ ìœ„ì¹˜ -->
                    <div class="form-group mb-0">
                        <label for="reportLocation" class="form-label form-label-required">
                            ì ë°œ ìœ„ì¹˜
                        </label>
                        <textarea id="reportLocation" name="reportLocation" class="form-input form-textarea w-full"
                            rows="2" placeholder="êµ­ë„ 17í˜¸ì„  ì¶©ë¶ ì²­ì£¼ì‹œ ì„œì›êµ¬ í˜„ë„ë©´ ì£½ì•”ë¦¬" required></textarea>
                        <p class="text-xs text-gray-500 mt-1">ë„ë¡œëª… ë˜ëŠ” ìƒì„¸ ì£¼ì†Œ ì…ë ¥</p>
                    </div>
                </section>

                <!-- Section 2: ìš´ì „ì ì •ë³´ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">ğŸ‘¤</span>
                        ìš´ì „ì ì •ë³´
                    </h2>

                    <!-- ì„±ëª… -->
                    <div class="form-group">
                        <label for="driverName" class="form-label form-label-required">
                            ì„±ëª…
                        </label>
                        <input type="text" id="driverName" name="driverName" class="form-input w-full" placeholder="í™ê¸¸ë™"
                            required>
                    </div>

                    <!-- ì£¼ì†Œ -->
                    <div class="form-group">
                        <label for="driverAddress" class="form-label form-label-required">
                            ì£¼ì†Œ
                        </label>
                        <input type="text" id="driverAddress" name="driverAddress" class="form-input w-full"
                            placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" required>
                    </div>

                    <!-- ì „í™”ë²ˆí˜¸ ê·¸ë£¹ -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- ì¼ë°˜ì „í™”ë²ˆí˜¸ -->
                        <div class="form-group mb-0">
                            <label for="phoneFixed" class="form-label">
                                ì¼ë°˜ì „í™”ë²ˆí˜¸
                            </label>
                            <input type="tel" id="phoneFixed" name="phoneFixed" class="form-input w-full"
                                placeholder="043-123-4567" maxlength="13" inputmode="tel">
                        </div>

                        <!-- íœ´ëŒ€ì „í™”ë²ˆí˜¸ -->
                        <div class="form-group mb-0">
                            <label for="phoneMobile" class="form-label form-label-required">
                                íœ´ëŒ€ì „í™”ë²ˆí˜¸
                            </label>
                            <input type="tel" id="phoneMobile" name="phoneMobile" class="form-input w-full"
                                placeholder="010-1234-5678" maxlength="13" inputmode="tel" required>
                        </div>
                    </div>
                </section>

                <!-- Section 3: ì°¨ëŸ‰ ì •ë³´ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">ğŸš›</span>
                        ì°¨ëŸ‰ ì •ë³´
                    </h2>

                    <!-- ì°¨ì¢… & ë“±ë¡ë²ˆí˜¸ -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- ì°¨ì¢… -->
                        <div class="form-group">
                            <label for="vehicleType" class="form-label form-label-required">
                                ì°¨ì¢…
                            </label>
                            <input type="text" id="vehicleType" name="vehicleType" class="form-input w-full"
                                placeholder="5í†¤ ì¹´ê³ " required>
                        </div>

                        <!-- ë“±ë¡ë²ˆí˜¸ -->
                        <div class="form-group">
                            <label for="plateNumber" class="form-label form-label-required">
                                ë“±ë¡ë²ˆí˜¸
                            </label>
                            <input type="text" id="plateNumber" name="plateNumber" class="form-input w-full uppercase"
                                placeholder="81ì†Œ5678" required>
                        </div>
                    </div>

                    <!-- ìš´í–‰ê²½ë¡œ -->
                    <div class="form-group">
                        <label for="route" class="form-label form-label-required">
                            ìš´í–‰ê²½ë¡œ
                        </label>
                        <input type="text" id="route" name="route" class="form-input w-full" placeholder="ì²­ì£¼ë°©ë©´ - ë‹¬ê³„ë¦¬"
                            required>
                    </div>

                    <!-- ì ì¬ë¬¼ -->
                    <div class="form-group mb-0">
                        <label for="cargo" class="form-label form-label-required">
                            ì ì¬ë¬¼
                        </label>
                        <input type="text" id="cargo" name="cargo" class="form-input w-full" placeholder="ëª©ì¬" required>
                    </div>
                </section>

                <!-- Section 4: ì°¨ëŸ‰ê·œê²© -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">ğŸ“</span>
                        ì°¨ëŸ‰ê·œê²©
                    </h2>

                    <!-- í…Œì´ë¸” í—¤ë” -->
                    <div class="grid grid-cols-4 gap-2 mb-2">
                        <div class="text-xs font-medium text-gray-500 text-center py-2">êµ¬ë¶„</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">ë„ˆë¹„</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">ë†’ì´</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">ê¸¸ì´</div>
                    </div>

                    <!-- ì¸¡ì •ê²°ê³¼ í–‰ -->
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <div
                            class="flex items-center justify-center text-sm font-medium text-gray-700 bg-gray-50 rounded-lg py-3">
                            ì¸¡ì •ê²°ê³¼
                        </div>
                        <div class="relative">
                            <input type="number" id="widthMeasured" name="widthMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="heightMeasured" name="heightMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="lengthMeasured" name="lengthMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                    </div>

                    <!-- ìœ„ë°˜ë‚´ì—­ í–‰ -->
                    <div class="grid grid-cols-4 gap-2">
                        <div
                            class="flex items-center justify-center text-sm font-medium text-warning bg-red-50 rounded-lg py-3">
                            ìœ„ë°˜ë‚´ì—­
                        </div>
                        <div class="relative">
                            <input type="number" id="widthViolation" name="widthViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200 focus:border-red-400"
                                step="0.01" inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="heightViolation" name="heightViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200 focus:border-red-400"
                                step="0.01" inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="lengthViolation" name="lengthViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200 focus:border-red-400"
                                step="0.01" inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                    </div>

                    <p class="text-xs text-gray-500 mt-3">â€» ì´ˆê³¼ëœ ìˆ˜ì¹˜ë§Œ ìœ„ë°˜ë‚´ì—­ì— ì…ë ¥í•˜ì„¸ìš”</p>
                </section>

                <!-- Section 5: ì°¨ëŸ‰ì¤‘ëŸ‰ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">âš–ï¸</span>
                        ì°¨ëŸ‰ì¤‘ëŸ‰
                        <span class="ml-auto text-xs font-normal text-gray-500">ë‹¨ìœ„: í†¤</span>
                    </h2>

                    <!-- ê°€ë¡œ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ -->
                    <div class="overflow-x-auto -mx-4 px-4">
                        <div class="min-w-[700px]">
                            <!-- í…Œì´ë¸” í—¤ë” -->
                            <div class="grid grid-cols-10 gap-1 mb-2">
                                <div class="text-xs font-medium text-gray-500 text-center py-2">êµ¬ë¶„</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">1ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">2ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">3ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">4ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">5ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">6ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">7ì¶•</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">8ì¶•</div>
                                <div
                                    class="text-xs font-medium text-primary-600 text-center py-2 bg-primary-50 rounded">
                                    ì´ì¤‘ëŸ‰</div>
                            </div>

                            <!-- ì¸¡ì •ê²°ê³¼ í–‰ -->
                            <div class="grid grid-cols-10 gap-1 mb-2">
                                <div
                                    class="flex items-center justify-center text-xs font-medium text-gray-700 bg-gray-50 rounded py-2">
                                    ì¸¡ì •
                                </div>
                                <input type="number" id="axle1Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle2Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle3Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle4Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle5Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle6Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle7Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle8Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <div class="relative">
                                    <input type="text" id="totalWeightMeasured"
                                        class="form-input text-center text-sm p-2 bg-primary-50 font-bold" readonly
                                        value="0.00">
                                    <span id="totalMeasuredWarning"
                                        class="hidden absolute -top-1 -right-1 text-warning text-xs">âš ï¸</span>
                                </div>
                            </div>

                            <!-- ìœ„ë°˜ë‚´ì—­ í–‰ -->
                            <div class="grid grid-cols-10 gap-1">
                                <div
                                    class="flex items-center justify-center text-xs font-medium text-warning bg-red-50 rounded py-2">
                                    ìœ„ë°˜
                                </div>
                                <input type="number" id="axle1Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle2Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle3Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle4Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle5Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle6Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle7Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle8Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <div class="relative">
                                    <input type="text" id="totalWeightViolation"
                                        class="form-input text-center text-sm p-2 bg-red-100 font-bold text-warning"
                                        readonly value="0.00">
                                    <span id="totalViolationWarning"
                                        class="hidden absolute -top-1 -right-1 text-warning text-xs">âš ï¸</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìœ„ë°˜ ê¸°ì¤€ ì•ˆë‚´ -->
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-xs text-gray-600">
                            <span class="font-medium">â€» ìœ„ë°˜ ê¸°ì¤€:</span>
                            ì¶•í•˜ì¤‘ <span class="font-bold text-warning">11.00í†¤</span> ì´ˆê³¼ /
                            ì´ì¤‘ëŸ‰ <span class="font-bold text-warning">44.00í†¤</span> ì´ˆê³¼
                        </p>
                        <div id="violationSummary"
                            class="hidden mt-2 p-2 bg-red-100 rounded text-xs font-medium text-warning">
                            âš ï¸ ê¸°ì¤€ ì´ˆê³¼ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤!
                        </div>
                </section>

                <!-- Section 6: ì‘ì„±ì ì •ë³´ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">âœï¸</span>
                        ì‘ì„±ì ì •ë³´
                    </h2>

                    <!-- ë…„ì›”ì¼ -->
                    <div class="form-group">
                        <label for="authorDate" class="form-label form-label-required">
                            ë…„ì›”ì¼
                        </label>
                        <input type="date" id="authorDate" name="authorDate" class="form-input w-full" required>
                    </div>

                    <!-- ì†Œì† & ì§ê¸‰ -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="authorOffice" class="form-label form-label-required">
                                ì†Œì†
                            </label>
                            <input type="text" id="authorOffice" name="authorOffice" class="form-input w-full"
                                value="ë³´ì€êµ­í† ê´€ë¦¬ì‚¬ë¬´ì†Œ" required>
                        </div>

                        <div class="form-group">
                            <label for="authorPosition" class="form-label form-label-required">
                                ì§ê¸‰
                            </label>
                            <input type="text" id="authorPosition" name="authorPosition" class="form-input w-full"
                                value="ìš´í–‰ì œí•œë‹¨ì†ì›" required>
                        </div>
                    </div>

                    <!-- ì„±ëª… -->
                    <div class="form-group mb-0">
                        <label for="authorName" class="form-label form-label-required">
                            ì„±ëª…
                        </label>
                        <input type="text" id="authorName" name="authorName" class="form-input w-full" placeholder="ì´ìš©ì¤€"
                            required>
                    </div>
                </section>

            </form>
        </div>
    </main>

    <!-- Fixed Footer - Two Buttons -->
    <footer class="footer-fixed bg-white">
        <div class="container">
            <div class="flex gap-3">
                <!-- ì„ì‹œ ì €ì¥ ë²„íŠ¼ -->
                <button type="button" id="btn-save"
                    class="flex-1 btn btn-outline flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4">
                        </path>
                    </svg>
                    ì„ì‹œ ì €ì¥
                </button>

                <!-- PDF ìƒì„± ë²„íŠ¼ -->
                <button type="button" id="btn-generate-pdf"
                    class="flex-[2] btn btn-primary flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    PDF ìƒì„±í•˜ê¸°
                </button>
            </div>
        </div>
    </footer>

    <!-- Hidden File Input for PDF Template -->
    <input type="file" id="pdfTemplateInput" accept=".pdf" style="display: none;">

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/pdf-handler.js"></script>
    <script src="js/pdf-coordinates.js"></script>
    <script src="js/pdf-generator.js"></script>

    <!-- Page Specific Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // === Phone Number Auto-Hyphen Formatter ===
            function formatPhoneNumber(value) {
                // Remove all non-digits
                const numbers = value.replace(/\D/g, '');

                // Format based on length
                if (numbers.length <= 3) {
                    return numbers;
                } else if (numbers.length <= 6) {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
                } else if (numbers.length <= 10) {
                    // 010-123-4567 or 02-1234-5678
                    if (numbers.startsWith('02')) {
                        return `${numbers.slice(0, 2)}-${numbers.slice(2, 6)}-${numbers.slice(6)}`;
                    }
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 6)}-${numbers.slice(6)}`;
                } else {
                    // 010-1234-5678
                    if (numbers.startsWith('02')) {
                        return `${numbers.slice(0, 2)}-${numbers.slice(2, 6)}-${numbers.slice(6, 10)}`;
                    }
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`;
                }
            }

            // Apply phone formatter to phone inputs
            const phoneInputs = document.querySelectorAll('input[type="tel"]');
            phoneInputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    e.target.value = formatPhoneNumber(e.target.value);
                });
            });

            // === Plate Number Uppercase Converter ===
            const plateInput = document.getElementById('plateNumber');
            if (plateInput) {
                plateInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.toUpperCase();
                });
            }

            // === Set default datetime to current ===
            const datetimeInput = document.getElementById('reportDatetime');
            if (datetimeInput && !datetimeInput.value) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                datetimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
            }

            // === Set default author date to today ===
            const authorDateInput = document.getElementById('authorDate');
            if (authorDateInput && !authorDateInput.value) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                authorDateInput.value = `${year}-${month}-${day}`;
            }

            // === Form Fields List ===
            const formFields = [
                'reportDatetime', 'reportLocation',
                'driverName', 'driverAddress', 'phoneFixed', 'phoneMobile',
                'vehicleType', 'plateNumber', 'route', 'cargo',
                'widthMeasured', 'heightMeasured', 'lengthMeasured',
                'widthViolation', 'heightViolation', 'lengthViolation',
                'axle1Measured', 'axle2Measured', 'axle3Measured', 'axle4Measured',
                'axle5Measured', 'axle6Measured', 'axle7Measured', 'axle8Measured',
                'axle1Violation', 'axle2Violation', 'axle3Violation', 'axle4Violation',
                'axle5Violation', 'axle6Violation', 'axle7Violation', 'axle8Violation',
                'authorDate', 'authorOffice', 'authorPosition', 'authorName'
            ];

            // === Save Button Handler ===
            const saveBtn = document.getElementById('btn-save');
            if (saveBtn) {
                saveBtn.addEventListener('click', () => {
                    const formData = {};
                    formFields.forEach(field => {
                        const el = document.getElementById(field);
                        if (el) formData[field] = el.value;
                    });
                    saveToStorage('report_draft', formData);
                    showToast('ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                });
            }

            // === Load Saved Draft ===
            const savedDraft = loadFromStorage('report_draft');
            if (savedDraft) {
                formFields.forEach(field => {
                    const el = document.getElementById(field);
                    if (el && savedDraft[field]) {
                        el.value = savedDraft[field];
                    }
                });
            }

            // === PDF Generate Button Handler ===
            const pdfBtn = document.getElementById('btn-generate-pdf');
            if (pdfBtn) {
                pdfBtn.addEventListener('click', async () => {
                    // Validate required fields
                    const requiredFields = [
                        'reportDatetime', 'reportLocation',
                        'driverName', 'driverAddress', 'phoneMobile',
                        'vehicleType', 'plateNumber', 'route', 'cargo',
                        'authorName'
                    ];

                    let isValid = true;
                    requiredFields.forEach(field => {
                        const el = document.getElementById(field);
                        if (el && !el.value.trim()) {
                            el.classList.add('form-input-error');
                            isValid = false;
                        } else if (el) {
                            el.classList.remove('form-input-error');
                        }
                    });

                    if (!isValid) {
                        showToast('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                        return;
                    }

                    // PDF í…œí”Œë¦¿ íŒŒì¼ ì„ íƒ íŠ¸ë¦¬ê±°
                    const templateInput = document.getElementById('pdfTemplateInput');
                    templateInput.click();
                });
            }

            // === PDF Template File Handler ===
            const templateInput = document.getElementById('pdfTemplateInput');
            if (templateInput) {
                templateInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        // í¼ ë°ì´í„° ìˆ˜ì§‘
                        const formData = {};
                        formFields.forEach(field => {
                            const el = document.getElementById(field);
                            if (el) formData[field] = el.value;
                        });

                        // ìƒˆ ë©”ì¸ í•¨ìˆ˜ í˜¸ì¶œ (ë¡œë”©/í† ìŠ¤íŠ¸ ë‚´ì¥)
                        await generateReportPdf(file, formData);

                    } catch (error) {
                        console.error('PDF ìƒì„± ì‹¤íŒ¨:', error);
                        // ì˜¤ë¥˜ëŠ” generateReportPdf ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ë¨
                    }

                    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥)
                    templateInput.value = '';
                });
            }

            // ==========================================================================
            // ì°¨ëŸ‰ì¤‘ëŸ‰ ìë™ ê³„ì‚° ë° ìœ„ë°˜ ê¸°ì¤€ ì²´í¬
            // ==========================================================================

            const AXLE_LIMIT = 11.00;  // ì¶•í•˜ì¤‘ ì œí•œ (í†¤)
            const TOTAL_LIMIT = 44.00; // ì´ì¤‘ëŸ‰ ì œí•œ (í†¤)

            // ì´ì¤‘ëŸ‰ ê³„ì‚° í•¨ìˆ˜
            function calculateTotalWeight(type) {
                let total = 0;
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}${type}`);
                    if (input && input.value) {
                        total += parseFloat(input.value) || 0;
                    }
                }
                return total;
            }

            // ìœ„ë°˜ ì²´í¬ ë° UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function checkViolations() {
                let hasViolation = false;

                // ì¸¡ì •ê²°ê³¼ ì¶•í•˜ì¤‘ ì²´í¬
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}Measured`);
                    if (input) {
                        const value = parseFloat(input.value) || 0;
                        if (value > AXLE_LIMIT) {
                            input.classList.add('font-bold', 'text-red-600', 'bg-red-50');
                            hasViolation = true;
                        } else {
                            input.classList.remove('font-bold', 'text-red-600', 'bg-red-50');
                        }
                    }
                }

                // ìœ„ë°˜ë‚´ì—­ ì¶•í•˜ì¤‘ ì²´í¬ (í•©ì‚°ìš©)
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}Violation`);
                    if (input) {
                        const value = parseFloat(input.value) || 0;
                        if (value > 0) {
                            hasViolation = true;
                        }
                    }
                }

                // ì¸¡ì •ê²°ê³¼ ì´ì¤‘ëŸ‰ ê³„ì‚° ë° í‘œì‹œ
                const totalMeasured = calculateTotalWeight('Measured');
                const totalMeasuredInput = document.getElementById('totalWeightMeasured');
                const totalMeasuredWarning = document.getElementById('totalMeasuredWarning');

                if (totalMeasuredInput) {
                    totalMeasuredInput.value = totalMeasured.toFixed(2);

                    if (totalMeasured > TOTAL_LIMIT) {
                        totalMeasuredInput.classList.add('font-bold', 'text-red-600');
                        if (totalMeasuredWarning) totalMeasuredWarning.classList.remove('hidden');
                        hasViolation = true;
                    } else {
                        totalMeasuredInput.classList.remove('text-red-600');
                        if (totalMeasuredWarning) totalMeasuredWarning.classList.add('hidden');
                    }
                }

                // ìœ„ë°˜ë‚´ì—­ ì´ì¤‘ëŸ‰ ê³„ì‚° ë° í‘œì‹œ
                const totalViolation = calculateTotalWeight('Violation');
                const totalViolationInput = document.getElementById('totalWeightViolation');
                const totalViolationWarning = document.getElementById('totalViolationWarning');

                if (totalViolationInput) {
                    totalViolationInput.value = totalViolation.toFixed(2);

                    if (totalViolation > 0) {
                        if (totalViolationWarning) totalViolationWarning.classList.remove('hidden');
                    } else {
                        if (totalViolationWarning) totalViolationWarning.classList.add('hidden');
                    }
                }

                // ìœ„ë°˜ ìš”ì•½ í‘œì‹œ
                const violationSummary = document.getElementById('violationSummary');
                if (violationSummary) {
                    if (hasViolation) {
                        violationSummary.classList.remove('hidden');
                    } else {
                        violationSummary.classList.add('hidden');
                    }
                }
            }

            // ëª¨ë“  ì¤‘ëŸ‰ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const weightInputs = document.querySelectorAll('.weight-input, .violation-input');
            weightInputs.forEach(input => {
                input.addEventListener('input', checkViolations);
            });

            // ì´ˆê¸° ë¡œë“œ ì‹œ ê³„ì‚° ì‹¤í–‰
            checkViolations();

            // ==========================================================================
            // ìë™ ì €ì¥ ê¸°ëŠ¥ (5ì´ˆë§ˆë‹¤)
            // ==========================================================================

            function saveFormData() {
                const formData = {};
                formFields.forEach(field => {
                    const el = document.getElementById(field);
                    if (el) formData[field] = el.value;
                });
                saveToStorage('report_draft', formData);
            }

            // 5ì´ˆë§ˆë‹¤ ìë™ ì €ì¥
            setInterval(() => {
                saveFormData();
                console.log('ìë™ ì €ì¥ ì™„ë£Œ:', new Date().toLocaleTimeString());
            }, 5000);

            // í˜ì´ì§€ é›¢é–‹ ì‹œ ì €ì¥
            window.addEventListener('beforeunload', saveFormData);

            // ============================================================
            // AI ì¢Œí‘œ ë¶„ì„ ê¸°ëŠ¥
            // ============================================================

            // PDF í…œí”Œë¦¿ ì„ íƒ ì‹œ AI ë¶„ì„ ì„¹ì…˜ í‘œì‹œ
            const pdfTemplateFile = document.getElementById('pdfTemplateFile');
            const aiAnalyzeSection = document.getElementById('aiAnalyzeSection');
            const aiCoordinatesStatus = document.getElementById('aiCoordinatesStatus');
            const analyzeTemplateBtn = document.getElementById('analyzeTemplateBtn');

            // ì €ì¥ëœ ì¢Œí‘œ í™•ì¸
            function updateAiCoordinatesStatus() {
                if (typeof GeminiAnalyzer !== 'undefined' && GeminiAnalyzer.hasCoordinates()) {
                    const coords = GeminiAnalyzer.loadCoordinates();
                    const date = new Date(coords.analyzedAt).toLocaleDateString('ko-KR');
                    aiCoordinatesStatus.textContent = `âœ… ë¶„ì„ë¨ (${date})`;
                    aiCoordinatesStatus.className = 'text-xs text-green-600';
                } else {
                    aiCoordinatesStatus.textContent = 'âšª ë¶„ì„ í•„ìš”';
                    aiCoordinatesStatus.className = 'text-xs text-gray-400';
                }
            }

            // í…œí”Œë¦¿ ì„ íƒ ì‹œ
            if (pdfTemplateFile) {
                pdfTemplateFile.addEventListener('change', () => {
                    if (pdfTemplateFile.files.length > 0) {
                        aiAnalyzeSection.classList.remove('hidden');
                        updateAiCoordinatesStatus();
                    } else {
                        aiAnalyzeSection.classList.add('hidden');
                    }
                });
            }

            // AI ë¶„ì„ ë²„íŠ¼ í´ë¦­
            if (analyzeTemplateBtn) {
                analyzeTemplateBtn.addEventListener('click', async () => {
                    // API í‚¤ í™•ì¸
                    if (typeof GeminiAnalyzer === 'undefined') {
                        showToast('Gemini ë¶„ì„ ëª¨ë“ˆì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                        return;
                    }

                    if (!GeminiAnalyzer.hasApiKey()) {
                        showToast('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                        setTimeout(() => window.location.href = 'settings.html', 1500);
                        return;
                    }

                    const file = pdfTemplateFile.files[0];
                    if (!file) {
                        showToast('PDF í…œí”Œë¦¿ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”', 'warning');
                        return;
                    }

                    // ë²„íŠ¼ ë¹„í™œì„±í™”
                    analyzeTemplateBtn.disabled = true;
                    analyzeTemplateBtn.innerHTML = '<span>â³</span><span>ë¶„ì„ ì¤‘...</span>';

                    try {
                        await GeminiAnalyzer.analyzePdf(file, (progress) => {
                            console.log('[AI ë¶„ì„]', progress);
                            analyzeTemplateBtn.innerHTML = `<span>â³</span><span>${progress}</span>`;
                        });

                        updateAiCoordinatesStatus();
                        showToast('PDF ë¶„ì„ ì™„ë£Œ! ì¢Œí‘œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');

                    } catch (error) {
                        console.error('[AI ë¶„ì„] ì‹¤íŒ¨:', error);
                        showToast('ë¶„ì„ ì‹¤íŒ¨: ' + error.message, 'error');
                    } finally {
                        analyzeTemplateBtn.disabled = false;
                        analyzeTemplateBtn.innerHTML = '<span>ğŸ¤–</span><span>AI ì¢Œí‘œ ë¶„ì„</span>';
                    }
                });
            }

            // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
            updateAiCoordinatesStatus();
        });
    </script>

    <!-- Gemini Analyzer -->
    <script src="js/gemini-analyzer.js"></script>
</body>

</html>