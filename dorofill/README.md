# DoroFill 🚛

**운행제한 위반 적발 서류 PDF 자동 작성 시스템**

> 국토교통부 운행제한 단속 업무에서 사용하는 적발 보고서와 위반 진술서를 빠르고 정확하게 작성할 수 있는 모바일 최적화 웹 애플리케이션

---

## 📌 소개

DoroFill은 현장에서 스마트폰이나 태블릿으로 바로 서류를 작성하고 PDF를 생성할 수 있도록 설계된 오프라인 우선 웹 앱입니다.

### 왜 DoroFill인가?

| 기존 방식 | DoroFill |
|----------|----------|
| 📝 수기 작성 후 사무실에서 입력 | 📱 현장에서 즉시 작성 |
| ⏱️ 동일 데이터 2번 입력 | 🔄 데이터 자동 공유 (보고서 → 진술서) |
| 🧮 계산기로 총중량 계산 | ⚖️ 자동 계산 + 위반 강조 |
| 💾 저장 안 하면 날아감 | 💾 5초마다 자동 저장 |

---

## ✨ 주요 기능

### 📱 모바일 최적화
- 터치 친화적 UI (최소 44px 터치 영역)
- iOS Safari, Android Chrome 완벽 지원
- 숫자 키패드 자동 표시 (`inputmode="decimal"`)
- 가로 스크롤 없는 반응형 레이아웃

### ⚖️ 자동 계산
- 축하중 합계 → 총중량 실시간 계산
- 소수점 2자리 자동 반올림

### 🚨 위반 자동 감지
- **축하중 > 11.00톤** → 빨간색 강조
- **총중량 > 44.00톤** → 빨간색 강조
- "기준 초과 항목이 있습니다!" 경고 표시

### 💾 자동 저장/복원
- 5초마다 자동 저장 (localStorage)
- 페이지 새로고침해도 데이터 유지
- PDF 생성 성공 시 자동 삭제

### 📄 PDF 직접 생성
- 원본 양식 위에 텍스트 삽입
- 한글/숫자 정확한 위치 배치
- 위반값 굵은 글씨 자동 적용

### 🔄 데이터 공유
- 적발 보고서 → 위반 진술서 데이터 전달
- "최근 적발 건 불러오기" 버튼 클릭
- 중복 입력 제거

---

## 🚀 사용 방법

### Step 1: 시작하기

1. `index.html` 파일을 브라우저에서 열기
2. 작성할 문서 유형 선택:
   - **적발 보고서** - 위반 차량 적발 시 작성
   - **위반 진술서** - 운전자 진술 확인 시 작성

### Step 2: 적발 보고서 작성

```
1. [적발 보고서] 버튼 클릭
2. 📁 PDF 템플릿 선택 (양식 PDF 업로드)
3. 기본 정보 입력 (적발 일시, 위치)
4. 운전자 정보 입력
5. 차량 정보 입력 (차종, 등록번호)
6. 차량규격 입력 (너비, 높이, 길이)
7. 축하중 입력 (1축~8축)
   → 총중량 자동 계산됨!
   → 위반 시 빨간색 표시됨!
8. 작성자 정보 입력
9. [PDF 생성하기] 클릭
10. PDF 다운로드 완료! ✅
```

### Step 3: 위반 진술서 작성

```
1. [위반 진술서] 버튼 클릭
2. 📥 [최근 적발 건 불러오기] 클릭
   → 적발 보고서 데이터 자동 입력됨!
3. 📁 PDF 템플릿 선택
4. 진술인 정보 추가 (최대 3명)
   - [+ 진술인 추가] 버튼 클릭
   - 소속, 직급, 성명 입력
5. [PDF 생성하기] 클릭
6. PDF 다운로드 완료! ✅
```

---

## ⚙️ 기술 스택

| 분류 | 기술 |
|-----|-----|
| **Frontend** | HTML5, CSS3, JavaScript (ES6+) |
| **Styling** | TailwindCSS 3.x (CDN) |
| **PDF** | pdf-lib 1.17.1 (CDN) |
| **Font** | Noto Sans KR (Google Fonts) |
| **Storage** | localStorage |

---

## 📦 파일 구조

```
dorofill/
├── index.html              # 메인 화면 (문서 선택)
├── report.html             # 적발 보고서 작성
├── statement.html          # 위반 진술서 작성
├── pdf-analyzer.html       # PDF 좌표 분석 도구 (개발용)
├── pdf-coordinate-picker.html  # 좌표 선택 도구 (개발용)
│
├── css/
│   └── styles.css          # 공통 스타일 + 모바일 최적화
│
├── js/
│   ├── app.js              # 핵심 로직 (저장, 토스트, 유틸리티)
│   ├── pdf-handler.js      # PDF 로드 + 텍스트 삽입 + 다운로드
│   ├── pdf-coordinates.js  # PDF 필드별 좌표 설정
│   ├── pdf-generator.js    # PDF 생성 시나리오
│   ├── calculator.js       # 계산 함수 (과태료, 중량)
│   └── validator.js        # 입력 검증 + 위반 체크
│
├── assets/                 # 이미지, 아이콘 등
│   └── .gitkeep
│
└── README.md               # 이 문서
```

---

## 🔧 설정 및 커스터마이징

### PDF 좌표 수정

PDF 양식이 변경되면 좌표를 조정해야 합니다.

```javascript
// js/pdf-coordinates.js

const PDF_COORDINATES = {
    page1: {
        // 적발 일시 (년/월/일/시/분)
        dateYear: { x: 167, y: 721, size: 11 },
        dateMonth: { x: 198, y: 721, size: 11 },
        dateDay: { x: 220, y: 721, size: 11 },
        // ... 기타 필드
    },
    page2: {
        // 위반 진술서 필드
        // ...
    }
};
```

**좌표 확인 방법:**
1. `pdf-coordinate-picker.html` 열기
2. PDF 양식 업로드
3. 클릭 위치의 좌표 확인
4. `pdf-coordinates.js` 업데이트

### 위반 기준 변경

```javascript
// js/validator.js

const WEIGHT_LIMITS = {
    AXLE: 11.00,    // 축하중 제한 (톤)
    TOTAL: 44.00    // 총중량 제한 (톤)
};
```

### 자동 저장 간격 변경

```javascript
// js/app.js

const AUTO_SAVE_CONFIG = {
    intervalMs: 5000,  // 5초 → 원하는 값으로 변경
    enabled: true
};
```

---

## 📱 브라우저 지원

| 브라우저 | 지원 |
|---------|-----|
| iOS Safari 14+ | ✅ |
| Android Chrome 90+ | ✅ |
| Chrome (Desktop) | ✅ |
| Firefox (Desktop) | ✅ |
| Edge (Desktop) | ✅ |
| Safari (Desktop) | ✅ |
| Internet Explorer | ❌ |

---

## ⚠️ 주의사항

### PDF 템플릿 관련
- 📋 **반드시 PDF 템플릿 파일을 업로드해야 합니다**
- 템플릿 없이 [PDF 생성] 클릭 시 오류 메시지 표시
- 한 번 업로드하면 세션 동안 유지됨

### 데이터 저장 관련
- 🔒 모든 데이터는 **브라우저 내부**에만 저장됩니다 (서버 전송 없음)
- ❌ **시크릿/프라이빗 모드**에서는 자동 저장이 작동하지 않을 수 있습니다
- 🧹 브라우저 캐시 삭제 시 저장된 데이터도 삭제됩니다

### 네트워크 관련
- 🌐 최초 로드 시 인터넷 연결 필요 (CDN 라이브러리 로드)
- 이후에는 오프라인에서도 일부 기능 사용 가능

---

## 🐛 문제 해결

### PDF가 다운로드되지 않아요

**iOS Safari의 경우:**
- PDF가 새 탭에서 열립니다
- 공유 버튼 → "파일에 저장" 선택

**팝업 차단된 경우:**
- 브라우저 설정에서 팝업 허용
- 또는 URL 표시줄 옆 차단 아이콘 클릭

### 데이터가 복원되지 않아요

```
✓ localStorage 활성화 확인
✓ 시크릿 모드가 아닌지 확인
✓ 브라우저 저장 용량 확인 (5MB 제한)
```

### 글자가 잘못된 위치에 표시돼요

1. `pdf-coordinate-picker.html`로 정확한 좌표 확인
2. `js/pdf-coordinates.js` 수정
3. 페이지 새로고침 후 다시 테스트

### 축하중이 계산되지 않아요

- 숫자만 입력했는지 확인 (문자 입력 불가)
- 소수점은 `.` 사용 (쉼표 `,` 안 됨)

---

## 📋 완료 체크리스트

프로젝트 구축 시 다음을 확인하세요:

- [x] 프로젝트 구조 생성됨
- [x] 적발 보고서 UI 완성
- [x] 위반 진술서 UI 완성
- [x] PDF 처리 로직 작동
- [x] 자동 계산 정확함
- [x] 위반 체크 강조 작동
- [x] 데이터 저장/복원 작동
- [x] PDF 생성 성공
- [x] 모바일에서 정상 작동
- [x] 모든 테스트 통과

✅ **배포 준비 완료!**

---

## 📄 라이선스

내부 업무용으로 제작되었습니다.

---

## 📞 문의

국토교통부 운행제한 단속 업무 담당자에게 문의하세요.

---

<div align="center">

Made with ❤️ for 국토교통부 단속원분들

**DoroFill v1.0** | © 2026

</div>
