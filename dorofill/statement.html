<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="DoroFill - Ïö¥ÌñâÏ†úÌïú ÏúÑÎ∞ò ÏßÑÏà†ÏÑú ÏûëÏÑ±">
    <title>ÏúÑÎ∞ò ÏßÑÏà†ÏÑú - DoroFill</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- pdf-lib CDN -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- fontkit for custom fonts (Korean support) -->
    <script src="https://unpkg.com/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>
    <!-- PDF.js for PDF to image conversion (Gemini analysis) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Google Fonts - Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Noto Sans KR', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#2563eb',
                            600: '#1d4ed8',
                            700: '#1e40af',
                            800: '#1e3a8a',
                            900: '#1e3a8a',
                        },
                        success: '#10b981',
                        warning: '#ef4444',
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen bg-gray-50 font-sans">
    <!-- Fixed Header -->
    <header class="header-fixed bg-white shadow-sm">
        <div class="container flex items-center justify-between h-full">
            <!-- Back Button -->
            <a href="index.html"
                class="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors min-w-[44px] min-h-[44px] justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                <span class="text-sm hidden sm:inline">ÎèåÏïÑÍ∞ÄÍ∏∞</span>
            </a>

            <!-- Title -->
            <h1 class="text-lg font-bold text-gray-900">ÏúÑÎ∞ò ÏßÑÏà†ÏÑú ÏûëÏÑ±</h1>

            <!-- Save Button -->
            <button type="button" id="btn-save"
                class="flex items-center gap-1 px-3 py-2 text-sm font-medium text-primary-500 hover:bg-primary-50 rounded-lg transition-colors min-w-[44px] min-h-[44px] justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4">
                    </path>
                </svg>
                <span class="hidden sm:inline">Ï†ÄÏû•</span>
            </button>
        </div>
    </header>

    <!-- Main Content - Scrollable Area -->
    <main class="main-content">
        <div class="container">
            <!-- Load Data Button -->
            <button type="button" id="btn-load-report"
                class="w-full mb-4 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium rounded-xl shadow-md flex items-center justify-center gap-2 transition-all active:scale-[0.98]">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
                ÏµúÍ∑º Ï†ÅÎ∞ú Í±¥ Î∂àÎü¨Ïò§Í∏∞
            </button>

            <form id="statementForm" novalidate>

                <!-- PDF ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù ÏÑπÏÖò -->
                <section class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4 animate-fade-in">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-blue-700 mb-1">üìÅ PDF ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù</h3>
                            <p class="text-sm text-gray-600 mb-3">
                                ÏûëÏÑ±Ìï† PDF ÏñëÏãù ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî. <span class="text-gray-400">(ÏµúÏ¥à 1ÌöåÎßå ÌïÑÏöî)</span>
                            </p>

                            <label class="block">
                                <input type="file" id="pdfTemplateFile" accept=".pdf" class="block w-full text-sm text-gray-500
                                        file:mr-3 file:py-2 file:px-4
                                        file:rounded-lg file:border-0
                                        file:text-sm file:font-medium
                                        file:bg-blue-500 file:text-white
                                        hover:file:bg-blue-600
                                        file:cursor-pointer cursor-pointer
                                        file:transition-colors" />
                            </label>

                            <div id="templateStatus" class="mt-2 text-sm"></div>
                        </div>
                    </div>
                </section>

                <!-- Section 1: Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">üìç</span>
                        Í∏∞Î≥∏ Ï†ïÎ≥¥
                    </h2>

                    <!-- Ï†ÅÎ∞ú ÏùºÏãú -->
                    <div class="form-group">
                        <label for="reportDatetime" class="form-label form-label-required">
                            Ï†ÅÎ∞ú ÏùºÏãú
                        </label>
                        <input type="datetime-local" id="reportDatetime" name="reportDatetime" class="form-input w-full"
                            required>
                    </div>

                    <!-- Ï†ÅÎ∞ú ÏúÑÏπò -->
                    <div class="form-group mb-0">
                        <label for="reportLocation" class="form-label form-label-required">
                            Ï†ÅÎ∞ú ÏúÑÏπò
                        </label>
                        <textarea id="reportLocation" name="reportLocation" class="form-input form-textarea w-full"
                            rows="2" placeholder="Íµ≠ÎèÑ 17Ìò∏ÏÑ† Ï∂©Î∂Å Ï≤≠Ï£ºÏãú ÏÑúÏõêÍµ¨ ÌòÑÎèÑÎ©¥ Ï£ΩÏïîÎ¶¨" required></textarea>
                    </div>
                </section>

                <!-- Section 2: Ï∞®Îüâ Ï†ïÎ≥¥ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">üöõ</span>
                        Ï∞®Îüâ Ï†ïÎ≥¥
                    </h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Ï∞®Ï¢Ö -->
                        <div class="form-group mb-0">
                            <label for="vehicleType" class="form-label form-label-required">
                                Ï∞®Ï¢Ö
                            </label>
                            <input type="text" id="vehicleType" name="vehicleType" class="form-input w-full"
                                placeholder="5ÌÜ§ Ïπ¥Í≥†" required>
                        </div>

                        <!-- Îì±Î°ùÎ≤àÌò∏ -->
                        <div class="form-group mb-0">
                            <label for="plateNumber" class="form-label form-label-required">
                                Îì±Î°ùÎ≤àÌò∏
                            </label>
                            <input type="text" id="plateNumber" name="plateNumber" class="form-input w-full uppercase"
                                placeholder="81ÏÜå5678" required>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Ï∞®ÎüâÍ∑úÍ≤© -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">üìè</span>
                        Ï∞®ÎüâÍ∑úÍ≤©
                    </h2>

                    <!-- ÌÖåÏù¥Î∏î Ìó§Îçî -->
                    <div class="grid grid-cols-4 gap-2 mb-2">
                        <div class="text-xs font-medium text-gray-500 text-center py-2">Íµ¨Î∂Ñ</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">ÎÑàÎπÑ</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">ÎÜíÏù¥</div>
                        <div class="text-xs font-medium text-gray-500 text-center py-2">Í∏∏Ïù¥</div>
                    </div>

                    <!-- Ï∏°Ï†ïÍ≤∞Í≥º Ìñâ -->
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <div
                            class="flex items-center justify-center text-sm font-medium text-gray-700 bg-gray-50 rounded-lg py-3">
                            Ï∏°Ï†ïÍ≤∞Í≥º</div>
                        <div class="relative">
                            <input type="number" id="widthMeasured" name="widthMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="heightMeasured" name="heightMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="lengthMeasured" name="lengthMeasured"
                                class="form-input w-full text-center pr-6" step="0.01" inputmode="decimal"
                                placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                    </div>

                    <!-- ÏúÑÎ∞òÎÇ¥Ïó≠ Ìñâ -->
                    <div class="grid grid-cols-4 gap-2">
                        <div
                            class="flex items-center justify-center text-sm font-medium text-warning bg-red-50 rounded-lg py-3">
                            ÏúÑÎ∞òÎÇ¥Ïó≠</div>
                        <div class="relative">
                            <input type="number" id="widthViolation" name="widthViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200" step="0.01"
                                inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="heightViolation" name="heightViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200" step="0.01"
                                inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="lengthViolation" name="lengthViolation"
                                class="form-input w-full text-center pr-6 bg-red-50 border-red-200" step="0.01"
                                inputmode="decimal" placeholder="0.00">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">m</span>
                        </div>
                    </div>

                    <p class="text-xs text-gray-500 mt-3">‚Äª Ï¥àÍ≥ºÎêú ÏàòÏπòÎßå ÏúÑÎ∞òÎÇ¥Ïó≠Ïóê ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
                </section>

                <!-- Section 4: Ï∞®ÎüâÏ§ëÎüâ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">‚öñÔ∏è</span>
                        Ï∞®ÎüâÏ§ëÎüâ
                        <span class="ml-auto text-xs font-normal text-gray-500">Îã®ÏúÑ: ÌÜ§</span>
                    </h2>

                    <!-- Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ Ïª®ÌÖåÏù¥ÎÑà -->
                    <div class="overflow-x-auto -mx-4 px-4">
                        <div class="min-w-[700px]">
                            <!-- ÌÖåÏù¥Î∏î Ìó§Îçî -->
                            <div class="grid grid-cols-10 gap-1 mb-2">
                                <div class="text-xs font-medium text-gray-500 text-center py-2">Íµ¨Î∂Ñ</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">1Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">2Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">3Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">4Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">5Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">6Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">7Ï∂ï</div>
                                <div class="text-xs font-medium text-gray-500 text-center py-2">8Ï∂ï</div>
                                <div
                                    class="text-xs font-medium text-primary-600 text-center py-2 bg-primary-50 rounded">
                                    Ï¥ùÏ§ëÎüâ</div>
                            </div>

                            <!-- Ï∏°Ï†ïÍ≤∞Í≥º Ìñâ -->
                            <div class="grid grid-cols-10 gap-1 mb-2">
                                <div
                                    class="flex items-center justify-center text-xs font-medium text-gray-700 bg-gray-50 rounded py-2">
                                    Ï∏°Ï†ï</div>
                                <input type="number" id="axle1Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle2Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle3Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle4Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle5Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle6Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle7Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle8Measured"
                                    class="weight-input form-input text-center text-sm p-2" step="0.01"
                                    inputmode="decimal" placeholder="0.00">
                                <div class="relative">
                                    <input type="text" id="totalWeightMeasured"
                                        class="form-input text-center text-sm p-2 bg-primary-50 font-bold" readonly
                                        value="0.00">
                                    <span id="totalMeasuredWarning"
                                        class="hidden absolute -top-1 -right-1 text-warning text-xs">‚ö†Ô∏è</span>
                                </div>
                            </div>

                            <!-- ÏúÑÎ∞òÎÇ¥Ïó≠ Ìñâ -->
                            <div class="grid grid-cols-10 gap-1">
                                <div
                                    class="flex items-center justify-center text-xs font-medium text-warning bg-red-50 rounded py-2">
                                    ÏúÑÎ∞ò</div>
                                <input type="number" id="axle1Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle2Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle3Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle4Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle5Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle6Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle7Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <input type="number" id="axle8Violation"
                                    class="violation-input form-input text-center text-sm p-2 bg-red-50 border-red-200"
                                    step="0.01" inputmode="decimal" placeholder="0.00">
                                <div class="relative">
                                    <input type="text" id="totalWeightViolation"
                                        class="form-input text-center text-sm p-2 bg-red-100 font-bold text-warning"
                                        readonly value="0.00">
                                    <span id="totalViolationWarning"
                                        class="hidden absolute -top-1 -right-1 text-warning text-xs">‚ö†Ô∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏúÑÎ∞ò Í∏∞Ï§Ä ÏïàÎÇ¥ -->
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-xs text-gray-600">
                            <span class="font-medium">‚Äª ÏúÑÎ∞ò Í∏∞Ï§Ä:</span>
                            Ï∂ïÌïòÏ§ë <span class="font-bold text-warning">11.00ÌÜ§</span> Ï¥àÍ≥º /
                            Ï¥ùÏ§ëÎüâ <span class="font-bold text-warning">44.00ÌÜ§</span> Ï¥àÍ≥º
                        </p>
                        <div id="violationSummary"
                            class="hidden mt-2 p-2 bg-red-100 rounded text-xs font-medium text-warning">
                            ‚ö†Ô∏è Í∏∞Ï§Ä Ï¥àÍ≥º Ìï≠Î™©Ïù¥ ÏûàÏäµÎãàÎã§!
                        </div>
                    </div>
                </section>

                <!-- Section 5: ÏßÑÏà†Ïù∏ Ï†ïÎ≥¥ -->
                <section class="bg-white rounded-lg shadow-md p-4 mb-4 animate-fade-in">
                    <h2
                        class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
                        <span class="text-xl">‚úçÔ∏è</span>
                        ÏßÑÏà†Ïù∏ Ï†ïÎ≥¥
                        <span id="witnessCount"
                            class="ml-auto text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded-full">1Î™Ö</span>
                    </h2>

                    <!-- ÏßÑÏà†Ïù∏ Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà -->
                    <div id="witnessContainer">
                        <!-- ÏßÑÏà†Ïù∏ 1 (ÏÇ≠Ï†ú Î∂àÍ∞Ä) -->
                        <div class="witness-card bg-gray-50 rounded-lg p-4 mb-3" data-witness-id="1">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-medium text-primary-600">ÏßÑÏà†Ïù∏ 1</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div class="form-group mb-0">
                                    <label class="form-label text-xs">ÏÜåÏÜç</label>
                                    <input type="text" id="witness1Office" name="witness1Office"
                                        class="form-input w-full text-sm" placeholder="ÏÜåÏÜç">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label text-xs">ÏßÅÍ∏â</label>
                                    <input type="text" id="witness1Position" name="witness1Position"
                                        class="form-input w-full text-sm" placeholder="ÏßÅÍ∏â">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label text-xs">ÏÑ±Î™Ö</label>
                                    <input type="text" id="witness1Name" name="witness1Name"
                                        class="form-input w-full text-sm" placeholder="ÏÑ±Î™Ö">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏßÑÏà†Ïù∏ Ï∂îÍ∞Ä Î≤ÑÌäº -->
                    <button type="button" id="btn-add-witness"
                        class="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-primary-400 hover:text-primary-500 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        ÏßÑÏà†Ïù∏ Ï∂îÍ∞Ä (ÏµúÎåÄ 10Î™Ö)
                    </button>
                </section>

            </form>
        </div>
    </main>

    <!-- Fixed Footer - Two Buttons -->
    <footer class="footer-fixed bg-white">
        <div class="container">
            <div class="flex gap-3">
                <!-- ÏûÑÏãú Ï†ÄÏû• Î≤ÑÌäº -->
                <button type="button" id="btn-save-footer"
                    class="flex-1 btn btn-outline flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4">
                        </path>
                    </svg>
                    ÏûÑÏãú Ï†ÄÏû•
                </button>

                <!-- PDF ÏÉùÏÑ± Î≤ÑÌäº -->
                <button type="button" id="btn-generate-pdf"
                    class="flex-[2] btn btn-primary flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    PDF ÏÉùÏÑ±ÌïòÍ∏∞
                </button>
            </div>
        </div>
    </footer>

    <!-- Hidden File Input for PDF Template -->
    <input type="file" id="pdfTemplateInput" accept=".pdf" style="display: none;">

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/pdf-handler.js"></script>
    <script src="js/pdf-coordinates.js"></script>
    <script src="js/pdf-generator.js"></script>

    <!-- Page Specific Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // === Plate Number Uppercase Converter ===
            const plateInput = document.getElementById('plateNumber');
            if (plateInput) {
                plateInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.toUpperCase();
                });
            }

            // === Set default datetime to current ===
            const datetimeInput = document.getElementById('reportDatetime');
            if (datetimeInput && !datetimeInput.value) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                datetimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
            }

            // === Form Fields List ===
            const formFields = [
                'reportDatetime', 'reportLocation',
                'vehicleType', 'plateNumber',
                'widthMeasured', 'heightMeasured', 'lengthMeasured',
                'widthViolation', 'heightViolation', 'lengthViolation',
                'axle1Measured', 'axle2Measured', 'axle3Measured', 'axle4Measured',
                'axle5Measured', 'axle6Measured', 'axle7Measured', 'axle8Measured',
                'axle1Violation', 'axle2Violation', 'axle3Violation', 'axle4Violation',
                'axle5Violation', 'axle6Violation', 'axle7Violation', 'axle8Violation'
            ];

            // === Save Function ===
            function saveFormData() {
                const formData = {};
                formFields.forEach(field => {
                    const el = document.getElementById(field);
                    if (el) formData[field] = el.value;
                });
                saveToStorage('statement_draft', formData);
            }

            // === Save Button Handlers ===
            const saveBtn = document.getElementById('btn-save');
            const saveFooterBtn = document.getElementById('btn-save-footer');

            [saveBtn, saveFooterBtn].forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', () => {
                        saveFormData();
                        showToast('ÏûÑÏãú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§', 'success');
                    });
                }
            });

            // === Load Saved Draft ===
            const savedDraft = loadFromStorage('statement_draft');
            if (savedDraft) {
                formFields.forEach(field => {
                    const el = document.getElementById(field);
                    if (el && savedDraft[field]) {
                        el.value = savedDraft[field];
                    }
                });
            }

            // === Load Report Data Button ===
            const loadReportBtn = document.getElementById('btn-load-report');
            if (loadReportBtn) {
                loadReportBtn.addEventListener('click', () => {
                    // Î∞©Î≤ï 1: Í≥µÏú†Îêú Ï†ÅÎ∞ú Î≥¥Í≥†ÏÑú Îç∞Ïù¥ÌÑ∞ (PDF ÏÉùÏÑ± Ïãú Ï†ÄÏû•Îê®)
                    if (typeof loadSharedReportData === 'function' && hasSharedReportData()) {
                        loadSharedReportData();
                        return;
                    }

                    // Î∞©Î≤ï 2: ÏûêÎèô Ï†ÄÏû•Îêú Ï†ÅÎ∞ú Î≥¥Í≥†ÏÑú Îç∞Ïù¥ÌÑ∞ (Ìè¥Î∞±)
                    const reportData = loadFromStorage('report_draft');
                    if (!reportData) {
                        showToast('Î∂àÎü¨Ïò¨ Ï†ÅÎ∞ú Î≥¥Í≥†ÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§', 'warning');
                        return;
                    }

                    // Í≥µÌÜµ ÌïÑÎìúÎßå Î∂àÎü¨Ïò§Í∏∞
                    const sharedFields = [
                        'reportDatetime', 'reportLocation',
                        'vehicleType', 'plateNumber',
                        'widthMeasured', 'heightMeasured', 'lengthMeasured',
                        'widthViolation', 'heightViolation', 'lengthViolation',
                        'axle1Measured', 'axle2Measured', 'axle3Measured', 'axle4Measured',
                        'axle5Measured', 'axle6Measured', 'axle7Measured', 'axle8Measured',
                        'axle1Violation', 'axle2Violation', 'axle3Violation', 'axle4Violation',
                        'axle5Violation', 'axle6Violation', 'axle7Violation', 'axle8Violation'
                    ];

                    let loadedCount = 0;
                    sharedFields.forEach(field => {
                        const el = document.getElementById(field);
                        if (el && reportData[field]) {
                            el.value = reportData[field];
                            loadedCount++;
                        }
                    });

                    // Ï¥ùÏ§ëÎüâ Ïû¨Í≥ÑÏÇ∞
                    checkViolations();

                    showToast(`Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§ (${loadedCount}Í∞ú ÌïÑÎìú)`, 'success');
                });
            }

            // === PDF Generate Button Handler ===
            const pdfBtn = document.getElementById('btn-generate-pdf');
            if (pdfBtn) {
                pdfBtn.addEventListener('click', async () => {
                    const requiredFields = ['reportDatetime', 'reportLocation', 'vehicleType', 'plateNumber'];

                    let isValid = true;
                    requiredFields.forEach(field => {
                        const el = document.getElementById(field);
                        if (el && !el.value.trim()) {
                            el.classList.add('form-input-error');
                            isValid = false;
                        } else if (el) {
                            el.classList.remove('form-input-error');
                        }
                    });

                    if (!isValid) {
                        showToast('ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'warning');
                        return;
                    }

                    // PDF ÌÖúÌîåÎ¶ø ÌååÏùº ÏÑ†ÌÉù Ìä∏Î¶¨Í±∞
                    const templateInput = document.getElementById('pdfTemplateInput');
                    templateInput.click();
                });
            }

            // === PDF Template File Handler ===
            const templateInput = document.getElementById('pdfTemplateInput');
            if (templateInput) {
                templateInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                        const formData = {};
                        formFields.forEach(field => {
                            const el = document.getElementById(field);
                            if (el) formData[field] = el.value;
                        });

                        // ÏßÑÏà†Ïù∏ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                        const witnesses = [];
                        const cards = witnessContainer.querySelectorAll('.witness-card');
                        cards.forEach((card, index) => {
                            const id = index + 1;
                            witnesses.push({
                                office: document.getElementById(`witness${id}Office`)?.value || '',
                                position: document.getElementById(`witness${id}Position`)?.value || '',
                                name: document.getElementById(`witness${id}Name`)?.value || ''
                            });
                        });

                        // ÏÉà Î©îÏù∏ Ìï®Ïàò Ìò∏Ï∂ú (Î°úÎî©/ÌÜ†Ïä§Ìä∏ ÎÇ¥Ïû•)
                        await generateStatementPdf(file, formData, witnesses);

                    } catch (error) {
                        console.error('PDF ÏÉùÏÑ± Ïã§Ìå®:', error);
                        // Ïò§Î•òÎäî generateStatementPdf ÎÇ¥Î∂ÄÏóêÏÑú Ï≤òÎ¶¨Îê®
                    }

                    // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùº Îã§Ïãú ÏÑ†ÌÉù Í∞ÄÎä•)
                    templateInput.value = '';
                });
            }

            // ==========================================================================
            // Ï∞®ÎüâÏ§ëÎüâ ÏûêÎèô Í≥ÑÏÇ∞ Î∞è ÏúÑÎ∞ò Í∏∞Ï§Ä Ï≤¥ÌÅ¨
            // ==========================================================================

            const AXLE_LIMIT = 11.00;
            const TOTAL_LIMIT = 44.00;

            function calculateTotalWeight(type) {
                let total = 0;
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}${type}`);
                    if (input && input.value) {
                        total += parseFloat(input.value) || 0;
                    }
                }
                return total;
            }

            function checkViolations() {
                let hasViolation = false;

                // Ï∏°Ï†ïÍ≤∞Í≥º Ï∂ïÌïòÏ§ë Ï≤¥ÌÅ¨
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}Measured`);
                    if (input) {
                        const value = parseFloat(input.value) || 0;
                        if (value > AXLE_LIMIT) {
                            input.classList.add('font-bold', 'text-red-600', 'bg-red-50');
                            hasViolation = true;
                        } else {
                            input.classList.remove('font-bold', 'text-red-600', 'bg-red-50');
                        }
                    }
                }

                // ÏúÑÎ∞òÎÇ¥Ïó≠ Ï∂ïÌïòÏ§ë Ï≤¥ÌÅ¨
                for (let i = 1; i <= 8; i++) {
                    const input = document.getElementById(`axle${i}Violation`);
                    if (input) {
                        const value = parseFloat(input.value) || 0;
                        if (value > 0) hasViolation = true;
                    }
                }

                // Ï∏°Ï†ïÍ≤∞Í≥º Ï¥ùÏ§ëÎüâ
                const totalMeasured = calculateTotalWeight('Measured');
                const totalMeasuredInput = document.getElementById('totalWeightMeasured');
                const totalMeasuredWarning = document.getElementById('totalMeasuredWarning');

                if (totalMeasuredInput) {
                    totalMeasuredInput.value = totalMeasured.toFixed(2);
                    if (totalMeasured > TOTAL_LIMIT) {
                        totalMeasuredInput.classList.add('font-bold', 'text-red-600');
                        if (totalMeasuredWarning) totalMeasuredWarning.classList.remove('hidden');
                        hasViolation = true;
                    } else {
                        totalMeasuredInput.classList.remove('text-red-600');
                        if (totalMeasuredWarning) totalMeasuredWarning.classList.add('hidden');
                    }
                }

                // ÏúÑÎ∞òÎÇ¥Ïó≠ Ï¥ùÏ§ëÎüâ
                const totalViolation = calculateTotalWeight('Violation');
                const totalViolationInput = document.getElementById('totalWeightViolation');
                const totalViolationWarning = document.getElementById('totalViolationWarning');

                if (totalViolationInput) {
                    totalViolationInput.value = totalViolation.toFixed(2);
                    if (totalViolation > 0) {
                        if (totalViolationWarning) totalViolationWarning.classList.remove('hidden');
                    } else {
                        if (totalViolationWarning) totalViolationWarning.classList.add('hidden');
                    }
                }

                // ÏúÑÎ∞ò ÏöîÏïΩ ÌëúÏãú
                const violationSummary = document.getElementById('violationSummary');
                if (violationSummary) {
                    if (hasViolation) {
                        violationSummary.classList.remove('hidden');
                    } else {
                        violationSummary.classList.add('hidden');
                    }
                }
            }

            // Ï§ëÎüâ ÏûÖÎ†• ÌïÑÎìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            const weightInputs = document.querySelectorAll('.weight-input, .violation-input');
            weightInputs.forEach(input => {
                input.addEventListener('input', checkViolations);
            });

            // Ï¥àÍ∏∞ Î°úÎìú Ïãú Í≥ÑÏÇ∞
            checkViolations();

            // ==========================================================================
            // ÏßÑÏà†Ïù∏ ÎèôÏ†Å Í¥ÄÎ¶¨
            // ==========================================================================

            const MAX_WITNESSES = 10;
            let witnessCount = 1;
            const witnessContainer = document.getElementById('witnessContainer');
            const addWitnessBtn = document.getElementById('btn-add-witness');
            const witnessCountSpan = document.getElementById('witnessCount');

            // ÏßÑÏà†Ïù∏ Ïπ¥Îìú HTML ÏÉùÏÑ±
            function createWitnessCard(id) {
                const card = document.createElement('div');
                card.className = 'witness-card bg-gray-50 rounded-lg p-4 mb-3 animate-fade-in';
                card.dataset.witnessId = id;
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-primary-600">ÏßÑÏà†Ïù∏ ${id}</span>
                        <button type="button" class="btn-delete-witness text-xs text-gray-400 hover:text-red-500 transition-colors p-1" data-id="${id}">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="form-group mb-0">
                            <label class="form-label text-xs">ÏÜåÏÜç</label>
                            <input type="text" id="witness${id}Office" name="witness${id}Office" class="form-input w-full text-sm" placeholder="ÏÜåÏÜç">
                        </div>
                        <div class="form-group mb-0">
                            <label class="form-label text-xs">ÏßÅÍ∏â</label>
                            <input type="text" id="witness${id}Position" name="witness${id}Position" class="form-input w-full text-sm" placeholder="ÏßÅÍ∏â">
                        </div>
                        <div class="form-group mb-0">
                            <label class="form-label text-xs">ÏÑ±Î™Ö</label>
                            <input type="text" id="witness${id}Name" name="witness${id}Name" class="form-input w-full text-sm" placeholder="ÏÑ±Î™Ö">
                        </div>
                    </div>
                `;
                return card;
            }

            // ÏßÑÏà†Ïù∏ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
            function updateWitnessCount() {
                const cards = witnessContainer.querySelectorAll('.witness-card');
                witnessCount = cards.length;
                if (witnessCountSpan) {
                    witnessCountSpan.textContent = `${witnessCount}Î™Ö`;
                }
                // 10Î™Ö ÎèÑÎã¨ Ïãú Ï∂îÍ∞Ä Î≤ÑÌäº Ïà®Í∏∞Í∏∞
                if (addWitnessBtn) {
                    addWitnessBtn.style.display = witnessCount >= MAX_WITNESSES ? 'none' : 'flex';
                }
            }

            // ÏßÑÏà†Ïù∏ ID Ïû¨Ï†ïÎ†¨
            function reorderWitnessIds() {
                const cards = witnessContainer.querySelectorAll('.witness-card');
                cards.forEach((card, index) => {
                    const newId = index + 1;
                    const oldId = card.dataset.witnessId;
                    card.dataset.witnessId = newId;

                    // ÎùºÎ≤® ÏóÖÎç∞Ïù¥Ìä∏
                    const label = card.querySelector('span.text-primary-600');
                    if (label) label.textContent = `ÏßÑÏà†Ïù∏ ${newId}`;

                    // ÏÇ≠Ï†ú Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏ (Ï≤´ Î≤àÏß∏Îäî ÏÇ≠Ï†ú Î≤ÑÌäº ÏóÜÏùå)
                    const deleteBtn = card.querySelector('.btn-delete-witness');
                    if (newId === 1 && deleteBtn) {
                        deleteBtn.remove();
                    } else if (deleteBtn) {
                        deleteBtn.dataset.id = newId;
                    }

                    // ÏûÖÎ†• ÌïÑÎìú ID ÏóÖÎç∞Ïù¥Ìä∏
                    ['Office', 'Position', 'Name'].forEach(field => {
                        const input = card.querySelector(`#witness${oldId}${field}`);
                        if (input) {
                            input.id = `witness${newId}${field}`;
                            input.name = `witness${newId}${field}`;
                        }
                    });
                });
                updateWitnessCount();
            }

            // ÏßÑÏà†Ïù∏ Ï∂îÍ∞Ä
            if (addWitnessBtn) {
                addWitnessBtn.addEventListener('click', () => {
                    if (witnessCount >= MAX_WITNESSES) {
                        showToast(`ÏµúÎåÄ ${MAX_WITNESSES}Î™ÖÍπåÏßÄ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§`, 'warning');
                        return;
                    }
                    const newId = witnessCount + 1;
                    const newCard = createWitnessCard(newId);
                    witnessContainer.appendChild(newCard);
                    updateWitnessCount();

                    // Ïä§ÌÅ¨Î°§ Ïù¥Îèô
                    newCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }

            // ÏßÑÏà†Ïù∏ ÏÇ≠Ï†ú (Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ)
            witnessContainer.addEventListener('click', (e) => {
                const deleteBtn = e.target.closest('.btn-delete-witness');
                if (deleteBtn) {
                    const id = deleteBtn.dataset.id;
                    const card = witnessContainer.querySelector(`[data-witness-id="${id}"]`);
                    if (card && id !== '1') {
                        card.classList.add('animate-fade-out');
                        setTimeout(() => {
                            card.remove();
                            reorderWitnessIds();
                        }, 200);
                    }
                }
            });

            // ÏßÑÏà†Ïù∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            function saveWitnessData() {
                const witnesses = [];
                const cards = witnessContainer.querySelectorAll('.witness-card');
                cards.forEach((card, index) => {
                    const id = index + 1;
                    witnesses.push({
                        office: document.getElementById(`witness${id}Office`)?.value || '',
                        position: document.getElementById(`witness${id}Position`)?.value || '',
                        name: document.getElementById(`witness${id}Name`)?.value || ''
                    });
                });
                saveToStorage('statement_witnesses', witnesses);
            }

            // ÏßÑÏà†Ïù∏ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
            function loadWitnessData() {
                const witnesses = loadFromStorage('statement_witnesses');
                if (witnesses && witnesses.length > 0) {
                    // Ï≤´ Î≤àÏß∏ ÏßÑÏà†Ïù∏ Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•
                    if (witnesses[0]) {
                        const w1 = witnesses[0];
                        if (document.getElementById('witness1Office')) document.getElementById('witness1Office').value = w1.office || '';
                        if (document.getElementById('witness1Position')) document.getElementById('witness1Position').value = w1.position || '';
                        if (document.getElementById('witness1Name')) document.getElementById('witness1Name').value = w1.name || '';
                    }

                    // Ï∂îÍ∞Ä ÏßÑÏà†Ïù∏ Ïπ¥Îìú ÏÉùÏÑ± Î∞è Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•
                    for (let i = 1; i < witnesses.length; i++) {
                        const newCard = createWitnessCard(i + 1);
                        witnessContainer.appendChild(newCard);

                        const w = witnesses[i];
                        document.getElementById(`witness${i + 1}Office`).value = w.office || '';
                        document.getElementById(`witness${i + 1}Position`).value = w.position || '';
                        document.getElementById(`witness${i + 1}Name`).value = w.name || '';
                    }
                    updateWitnessCount();
                }
            }

            // Ï¥àÍ∏∞ Î°úÎìú
            loadWitnessData();

            // Í∏∞Ï°¥ saveFormData ÌôïÏû•
            const originalSaveFormData = saveFormData;
            saveFormData = function () {
                originalSaveFormData();
                saveWitnessData();
            };

            // === ÏûêÎèô Ï†ÄÏû• (5Ï¥àÎßàÎã§) ===
            setInterval(() => {
                saveFormData();
                console.log('ÏûêÎèô Ï†ÄÏû• ÏôÑÎ£å:', new Date().toLocaleTimeString());
            }, 5000);

            window.addEventListener('beforeunload', saveFormData);
        });
    </script>

    <!-- Gemini Analyzer -->
    <script src="js/gemini-analyzer.js"></script>
</body>

</html>